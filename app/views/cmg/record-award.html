{% extends "layouts/main-2.html" %}

{% block content %}

    {% set originalWeeklyAmount = 202.93 %}
    {% set cmgDefaultAmount = 8.40 %}
    {% set cmgDefaultAdjusted = originalWeeklyAmount - cmgDefaultAmount %}
    {% set cmgDeductionDate = "26 January 2026" %}

    {% if data['adjustmentAmountType'] == "other" %}
      {% set cmgAmount = (originalWeeklyAmount - data['otherAmount']) %}
    {% else %}
      {% set cmgAmount = cmgDefaultAdjusted %}
    {% endif %}

    {% if data['adjustmentAmountType'] %}
      {% set cmgAdded = true %}
    {% endif %}

    {% set isChanged = data['changedAmount'] %}

    {% set isRemoved = (data['confirmRemoval'] == 'yes' or data['adjustmentAmount'] == 'removed') %}

    {% if isChanged %}
      {% set cmgChangedAmount = "£" + (originalWeeklyAmount - data['changedAmount']) %}
    {% endif %}


    {# {% if isRemoved %}
      {% set showCmgBanner = true %}
    {% elif isChanged %}
      {% set showCmgBanner = true %}
    {% elif (cmgAmount == cmgDefaultAmount) or (cmgAmount == cmgDefaultAdjusted) %}
      {% set showCmgBanner = true %}
    {% endif %}

    {% set html %}
      <h3 class="govuk-notification-banner__heading">
        Child Maintenance deduction applied
      </h3>
      <p class="govuk-body">This will apply to the current award from the next payment date.</p>
    {% endset %}

    {% if showCmgBanner %}
      {{ govukNotificationBanner({
        html: html,
        type: "success"
      }) }}
    {% endif %} #}

<div class="govuk-grid-row">
  <div class="govuk-grid-column-two-thirds">

    {% include './_person.html' %}

    {{ xGovukSecondaryNavigation({
      visuallyHiddenTitle: "Secondary menu",
      items: [{
        text: "Personal",
        href: "record-personal"
      },
      {
        text: "Contact",
        href: "record-contact"
      },
      {
        text: "Award",
        href: "record-award",
        current: true
      },
      {
        text: "Payment",
        href: "record-payment"
      },
      {
        text: "Tasks",
        href: "tasks"
      },
      {
        text: "Full history",
        href: "Full-history"
      }]
    }) }}

    <br>

    <style>
      .current-award-heading {
        display: flex;
        flex-wrap: wrap;
        gap: 1em;
        justify-content: space-between;
        align-items: baseline;
      }
    </style>

    <div class="current-award-heading">
      <h1 id="statePensionAwardsHeading" class="govuk-heading-m">State pension awards</h1>
      <p><a href="./adjustment">Make an adjustment</a></p>
    </div>

    {# <style>
      /* Make key 'column' wider than 30% default */
      @media (min-width: 40.0625em) {
        .govuk-summary-list__key { width: 50%; }
      }
      /* Distance top two list items from one another */
      .govuk-summary-list__row:nth-of-type(3) > * {
        padding-top: 2em;
      }
    </style>

    {{ govukSummaryList({
      rows: [
        {
          key: { text: "From" },
          value: { text: "10 April 2023" }
        },
        {
          key: { text: "Reason" },
          value: { text: "Uprating" }
        },
        {
          key: { text: "Total" },
          value: { text: newWeeklyAmount }
        },
        {
          key: { text: "New State Pension" },
          value: { text: originalWeeklyAmount }
        },
        {
          key: { text: "Protected payment" },
          value: { text: "£0.00" }
        },
        {
          key: { text: "Extra State Pension" },
          value: { text: "£0.00" }
        },
        {
          key: { text: "Inherited extra State Pension" },
          value: { text: "£0.00" }
        },
        {
          key: { text: "Child Maintenance deduction" },
          value: { text: cmgAmount }
        } if cmgAmount
      ]
    }) }}

    <br><br> #}

    {{ govukTable({
      attributes: 'aria-labelledby="statePensionAwardsHeading"',
      head: [
        { text: "From" },
        { text: "Weekly amount" },
        { text: "Adjustment" },
        { text: "" }
      ],
      rows: [
        [
          { text: cmgDeductionDate },
          { text: "£" + originalWeeklyAmount },
          { text: "" },
          { html: '<a href="#">Details</a>' }
        ] if isRemoved,
        [
          { text: cmgDeductionDate },
          { text: cmgChangedAmount },
          { text: "Yes" },
          { html: '<a href="#">Details</a>' }
        ] if isChanged,
        [
          { text: cmgDeductionDate },
          { text: "£" + cmgAmount },
          { text: "Yes" },
          { html: '<a href="#">Details</a>' }
        ] if cmgAdded,
        [
          { text: "10 April 2025" },
          { text: "£" + originalWeeklyAmount },
          { text: "" },
          { html: '<a href="#">Details</a>' }
        ],
        [
          { text: "11 April 2024" },
          { text: "£" + 194.95 },
          { text: "" },
          { html: '<a href="#">Details</a>' }
        ],
        [
          { text: "13 April 2023" },
          { text: "£" + 179.66 },
          { text: "" },
          { html: '<a href="#">Details</a>' }
        ],
        [
          { text: "20 September 2022" },
          { text: "£" + 163.18 },
          { text: "" },
          { html: '<a href="#">Details</a>' }
        ]
      ]
    }) }}

    <br><br><br>

  </div>

  <div class="govuk-grid-column-one-third">
    <h2 class="govuk-heading-m">Award changes</h2>

    <style>
      .dwp-timeline__item {
        display: flex;
        flex-direction: column;
      }
      .dwp-timeline__heading,
      .dwp-timeline__by-line,
      .dwp-timeline__datetime {
        font-size: 19px;
        line-height: 25px;
      }
      .dwp-timeline__heading {
        order: 1;
        margin-bottom: 0;
      }
      .dwp-timeline__by-line {
        order: 2;
        margin-bottom: 0;
      }
      .dwp-timeline__datetime {
        order: 4;
        color: #505a5f;
      }
      .dwp-timeline__link {
        order: 3;
      }
    </style>
    {% set timelineItems = [] %}

    {% if isRemoved %}
      {% set timelineItems = (timelineItems.push({
        title: "Letter sent: Child Maintenance deduction removed",
        byline: "System",
        date: cmgDeductionDate
      }), timelineItems) %}
      {% set timelineItems = (timelineItems.push({
        title: "Child Maintenance deduction removed",
        byline: "Agent",
        date: cmgDeductionDate
      }), timelineItems) %}
    {% endif %}

    {% if isChanged %}
      {% set timelineItems = (timelineItems.push({
        title: "Letter sent: Child Maintenance deduction changed",
        byline: "System",
        date: cmgDeductionDate
      }), timelineItems) %}
      {% set timelineItems = (timelineItems.push({
        title: "Child Maintenance deduction changed",
        byline: "Agent",
        date: cmgDeductionDate
      }), timelineItems) %}
    {% endif %}

    {% if cmgAdded %}
      {% set timelineItems = (timelineItems.push({
        title: "Letter sent: Child Maintenance deduction applied",
        byline: "System",
        date: cmgDeductionDate
      }), timelineItems) %}
      {% set timelineItems = (timelineItems.push({
        title: "Child Maintenance deduction applied",
        byline: "Agent",
        date: cmgDeductionDate
      }), timelineItems) %}
    {% endif %}

    {% set timelineItems = (timelineItems.push({
      title: "Claim received",
      byline: "Online",
      link: {
        href: "#",
        text: "View details",
        visuallyHiddenText: "of the event on 15 June 2021 at 4:01pm"
      },
      date: "20 September 2022"
    }), timelineItems) %}

    {{ dwpTimeline({
      items: timelineItems
    }) }}

    <script>
      document.querySelectorAll('.dwp-timeline__by-line')
      .forEach(element => {
        element.textContent = element.textContent.replace('by ', '');
      });
    </script>

    <p><a href="#">Full history</a></p>
  </div>

</div>



{% endblock %}
